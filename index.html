<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mario JS</title>
  <style>
    canvas {
      background: #87CEEB;
      display: block;
      margin: 0 auto;
      border: 2px solid black;
    }
    html, body {
  margin: 0;
  padding: 0;
  overflow: hidden;
  height: 100%;
}

canvas {
  width: 100vw;
  height: 100vh;
  display: block;
}


    #modalNivel {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      color: white;
      font-size: 24px;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 10;
    }

    #modalNivel > div {
      background: #222;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    #modalNivel button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }
    #controles button {
    font-size: 24px;
    padding: 15px 25px;
    margin: 5px;
    border: none;
    border-radius: 10px;
    background: #444;
    color: white;
    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
  }
  </style>
</head>
<body>
  <canvas id="juego"></canvas>
  <div id="controles" style="text-align:center; margin-top: 20px;">
  <button ontouchstart="keys['ArrowLeft'] = true" ontouchend="keys['ArrowLeft'] = false">‚óÄÔ∏è</button>
  <button ontouchstart="keys['Space'] = true" ontouchend="keys['Space'] = false">‚§í Saltar</button>
  <button ontouchstart="keys['ArrowRight'] = true" ontouchend="keys['ArrowRight'] = false">‚ñ∂Ô∏è</button>
</div>

<!-- Modal -->
<div id="modalNivel">
  <div>
    <p>¬°Nivel completado!</p>
    <button onclick="siguienteNivel()">Siguiente Nivel</button>
  </div>
</div>

<script>
const canvas = document.getElementById("juego");
const ctx = canvas.getContext("2d");

// Ajustar tama√±o real del canvas al tama√±o de la pantalla
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});


// Cargar im√°genes
const marioImg = new Image(); marioImg.src = "img/mario.gif";
const coinImg = new Image();  coinImg.src = "img/coin.png";
const enemyImg = new Image(); enemyImg.src = "img/enemy.png";

// Jugador
const player = {
  x: 50, y: 0, width: 40, height: 40,
  vx: 0, vy: 0,
  onGround: false,
  score: 0
};

// Niveles
let niveles = [];
let nivelActual = 0;
let platforms = [];
let coin = {};
let enemy = {};

// üîÅ Generar 7 niveles √∫nicos aleatorios
function generarNiveles() {
  for (let i = 0; i < 7; i++) {
    const plataformas = [];

    plataformas.push({ x: 0, y: 350, width: 800, height: 50 });

    const cantidad = Math.floor(Math.random() * 3) + 2;
    for (let j = 0; j < cantidad; j++) {
      const width = Math.floor(Math.random() * 100) + 60;
      const x = Math.floor(Math.random() * (800 - width));
      const y = Math.floor(Math.random() * 200) + 100;
      plataformas.push({ x, y, width, height: 20 });
    }

    const plataformaMoneda = plataformas[Math.floor(Math.random() * (plataformas.length - 1)) + 1];
    const coin = {
      x: plataformaMoneda.x + plataformaMoneda.width / 2 - 10,
      y: plataformaMoneda.y - 20,
      width: 20,
      height: 20,
      collected: false
    };

    const enemy = {
      x: Math.floor(Math.random() * 700) + 50,
      y: 310,
      width: 40,
      height: 40,
      dir: Math.random() < 0.5 ? -1 : 1
    };

    niveles.push({ plataformas, coin, enemy });
  }
}

function cargarNivel(n) {
  const nivel = niveles[n];
  platforms = nivel.plataformas;
  coin = { ...nivel.coin };
  enemy = { ...nivel.enemy };
  player.x = 50;
  player.y = 0;
  player.vx = 0;
  player.vy = 0;
}
// Controles
const keys = {};
document.addEventListener("keydown", e => keys[e.code] = true);
document.addEventListener("keyup", e => keys[e.code] = false);

// Actualizaci√≥n
function update() {
  // Movimiento
  if (keys["ArrowLeft"]) player.vx = -5;
  if (keys["ArrowRight"]) player.vx = 5;
  if (keys["Space"] && player.onGround) {
    player.vy = -15;
    player.onGround = false;
  }

  // F√≠sica
  player.vy += 0.8;
  player.x += player.vx;
  player.y += player.vy;
  player.vx *= 0.9;

  // Colisiones con plataformas
  player.onGround = false;
  platforms.forEach(p => {
    if (
      player.x < p.x + p.width &&
      player.x + player.width > p.x &&
      player.y < p.y + p.height &&
      player.y + player.height > p.y
    ) {
      if (player.vy > 0) {
        player.y = p.y - player.height;
        player.vy = 0;
        player.onGround = true;
      }
    }
  });

  // Moneda
  if (!coin.collected &&
      player.x < coin.x + coin.width &&
      player.x + player.width > coin.x &&
      player.y < coin.y + coin.height &&
      player.y + player.height > coin.y) {
    coin.collected = true;
    player.score += 1;

    juegoPausado = true;
    setTimeout(() => {
      document.getElementById("modalNivel").style.display = "flex";
    }, 300);
  }

  // Enemigo
  enemy.x += enemy.dir * 2;
  if (enemy.x <= 550 || enemy.x >= 700) enemy.dir *= -1;

  if (
    player.x < enemy.x + enemy.width &&
    player.x + player.width > enemy.x &&
    player.y < enemy.y + enemy.height &&
    player.y + player.height > enemy.y
  ) {
    alert("¬°Perdiste! Tu puntaje fue: " + player.score);
    location.reload();
  }
}

// Dibujar
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Plataformas
  ctx.fillStyle = "#228B22";
  platforms.forEach(p => ctx.fillRect(p.x, p.y, p.width, p.height));

  // Jugador
  ctx.drawImage(marioImg, player.x, player.y, player.width, player.height);

  // Moneda
  if (!coin.collected) {
    ctx.drawImage(coinImg, coin.x, coin.y, coin.width, coin.height);
  }

  // Enemigo
  ctx.drawImage(enemyImg, enemy.x, enemy.y, enemy.width, enemy.height);

  // Puntaje
  ctx.fillStyle = "black";
  ctx.font = "20px Arial";
  ctx.fillText("Puntaje: " + player.score, 10, 25);
}

// Bucle
function loop() {
  if (!juegoPausado) {
    update();
    draw();
    requestAnimationFrame(loop);
  }
}

// Siguiente nivel
function siguienteNivel() {
  nivelActual++;
  if (nivelActual >= niveles.length) {
    alert("¬°Juego terminado! Puntaje total: " + player.score);
    location.reload();
  } else {
    cargarNivel(nivelActual);
    document.getElementById("modalNivel").style.display = "none";
    juegoPausado = false;
    loop();
  }
}

// Iniciar juego
generarNiveles(); // ‚Üê genera los niveles aleatorios
let juegoPausado = false;

cargarNivel(nivelActual);
loop();
</script>
</body>
</html>
